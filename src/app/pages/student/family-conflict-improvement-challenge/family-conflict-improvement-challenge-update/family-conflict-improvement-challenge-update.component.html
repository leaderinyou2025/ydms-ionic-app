<app-header
  [pageTitle]="TranslateKeys.TITLE_UPDATE_CHALLENGE_PROGRESS"
  [defaultBackHref]="'/' + PageRoutes.FAMILY_CONFLICT_IMPROVEMENT_CHALLENGE + '/' + challengeId"
  backgroundColor="linear-gradient(to bottom, #9333ea, #4c1d95)"
>
</app-header>

<ion-content [fullscreen]="true" class="font-comic-sans">
  <!-- Loading spinner -->
  <ion-spinner *ngIf="isLoading" name="crescent"
               class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"></ion-spinner>

  <!-- Progress update form -->
  <div *ngIf="!isLoading && challengeDetail" class="p-4">
    <div class="bg-white rounded-xl shadow-md p-4 mb-4">
      <h1 class="text-xl font-semibold mb-2">{{ challengeDetail.title }}</h1>
      <p class="text-gray-500 mb-4">{{ TranslateKeys.LABEL_STARTED_ON | translate }}: {{ challengeDetail.date | date:'mediumDate' }}</p>

      <!-- Current progress -->
      <div class="mb-6">
        <div class="flex justify-between text-sm mb-1">
          <span class="text-gray-600">{{ TranslateKeys.LABEL_CURRENT_PROGRESS | translate }}</span>
          <span class="font-bold">{{ challengeDetail.progress }}%</span>
        </div>
        <ion-progress-bar [value]="challengeDetail.progress / 100"
                         color="primary"
                         class="h-2 rounded-full"></ion-progress-bar>
      </div>

      <!-- Progress slider -->
      <div class="mb-6">
        <h2 class="text-lg font-bold text-gray-700 mb-3">{{ TranslateKeys.TITLE_UPDATE_PROGRESS | translate }}</h2>

        <div class="flex justify-between text-sm mb-1">
          <span class="text-gray-600">{{ TranslateKeys.LABEL_NEW_PROGRESS | translate }}</span>
          <span class="font-bold">{{ progressValue }}%</span>
        </div>

        <ion-range [(ngModel)]="progressValue"
                  min="0"
                  max="100"
                  step="5"
                  pin="true"
                  color="primary"
                  class="mb-4">
          <span slot="start" class="text-gray-500 font-bold">0</span>
          <span slot="end" class="text-primary font-bold">100</span>
        </ion-range>

        <!-- Progress notes -->
        <ion-item class="rounded-lg mb-2">
          <ion-label position="stacked">{{ TranslateKeys.LABEL_PROGRESS_NOTES | translate }}</ion-label>
          <ion-textarea [(ngModel)]="progressNotes"
                       rows="4"
                       placeholder="{{ TranslateKeys.PLACEHOLDER_ENTER_PROGRESS_NOTES | translate }}">
          </ion-textarea>
        </ion-item>

        <p class="text-sm text-gray-500 px-2">
          {{ TranslateKeys.MESSAGE_PROGRESS_NOTES_HINT | translate }}
        </p>
      </div>
    </div>

    <!-- Action buttons -->
    <div class="flex justify-between">
      <ion-button (click)="navigateToDetail()"
                  class="w-1/2 mr-2 uppercase rounded-lg shadow-md"
                  color="medium">
        {{ 'BUTTON.cancel' | translate }}
      </ion-button>
      <ion-button (click)="updateProgress()"
                  class="w-1/2 ml-2 uppercase rounded-lg shadow-md"
                  color="primary">
        {{ TranslateKeys.BUTTON_UPDATE | translate }}
      </ion-button>
    </div>
  </div>
</ion-content>
